{% extends "layout.html" %}

{% block title %}Index{% endblock %}
{% block head %}
    {{ parent() }}
{% endblock %}

{% block content %}
<div class="row">
	<div class="col-md-12">
		<div class="box box-primary">
			<div class="box-header with-border"><h1 id="form_title"></h1></div>
			<form action="{{ path_for('form.create.submit') }}" method="post">
				<div id="form-items-container" class="form-items-container edit-mode box-body"></div>
				<div class="box-footer"><input type="button" class="btn btn-primary" value="save" onclick="serializeItem();" /></div>
			</form>
		</div>
	</div>
</div>
{% endblock %}

{% block sidebar %}
		
	
{% endblock %}

{% block scripts %}
<script src="./js/xtd/xtd.sdk.js"></script>
<script src="./js/xtd/xtd.sequencegenerator.js"></script>
<script src="./js/xtd/xtd.collection.js"></script>
<script src="./js/xtd/xtd.baseitem.js"></script>
<script src="./js/xtd/xtd.item.js"></script>
<script src="./js/xtd/xtd.editableitem.js"></script>
<script src="./js/xtd/xtd.property.js"></script>
<script src="./js/xtd/xtd.form.js"></script>
<script src="./js/xtd/xtd.properties.textbox.js"></script>
<script src="./js/xtd/xtd.properties.checkbox.js"></script>
<script src="./js/xtd/xtd.controls.singleline.js"></script>
<script src="./js/xtd/xtd.controls.textarea.js"></script>
<script src="./js/xtd/xtd.controls.checkbox.js"></script>
<script src="./js/xtd/xtd.controls.radio.js"></script>
<script src="./js/xtd/xtd.validators.mandatory.js"></script>
<script src="./js/xtd/xtd.fda.js"></script>
<script>
	//var formData = {};
	var fda = {};
	$(document).ready(function () {
		XTD.init({
				appId: '6d25b55d-987a-41dd-87b3-4db79b81f86c',
				version: '1.0',
				secret: '8861b2e14d94'
				});
		XTD.getLoginStatus(function (data) {
			if (!data.result) {
				XTD.login({'username':'admin','password':'admin'}, function (data) {
					consolelog(data);
				});
			} else {
				consolelog('login success');
			}
		});
		
		XTD.api('/form/def/1', function (data) {
			fda = new XTD.FDA(data.result, false).setItemContainerId('form-items-container');
			fda.renderAll();
		});
	});
	
	function serializeItem() {
		console.log(fda.serializeValue());
		//XTD.api('/form/def/1', 'PUT', fda.serializeItem(), function (data) {
		//	console.log(data);
		//});
	}
	
	var debug = 0;
	function consolelog(msg) {
		if (debug) {
			console.log(msg);
		}
	}
</script>
{% endblock %}
